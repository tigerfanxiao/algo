

# Model
生产者消费者模型


# 异步
如果某个服务需要10秒的时间去等待, 那这个服务就应该设计为异步进程. 这样他不会阻塞其他进程. 那么这个异步进程和网站之间的通信就通过MQ来实现

# Message Queue 
MQ也称会消息队列. 类似于派送快递前的仓库. 因为快递员有限, 先把大量的包裹先放在仓库里. 
MQ也是一种中间件

消费者获得消息有两种方式:
1. push方法: 生产者将信息放入队列, 然后通知消费者来取
2. pull方法: 消费者不断去轮询队列, 看看有没有新的数据, 如果有就消费

主要用户生产者和消费者模型. 
应用的场景
1. leetcode每个用户提交代码, 由评测机来进行代码评测
2. 电商网站的订单处理. 


常见的消息队列工具
1. Redis, Rabbitmq, celery

消息队列的问题
1. 消息重复消费了怎么办?
2. 保证消息的绝对顺序?
3. 


### 因为MQ导致的系统奔溃

系统需要发送大量邮件通知用户有一个新的商品上架. 发送邮件一般是作为异步任务. 通过MQ来实现. 比如1万个用户, 发送1万封邮件. 先将发送的邮件清单加入队列. 然后通过发送邮件的服务来处理. 遇到的实际问题是消息队列挂了, 导致网站的服务挂了. 解决的办法是重启服务, 然后清空消息队列. 

一个疑问, 如果是消息队列中的支付和订单, 肯定是不能清空的